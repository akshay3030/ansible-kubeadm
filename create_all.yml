---
#####################
# Install Python
#####################

- hosts: all
  gather_facts: false # As Python is not yet installed, we cannot gather host facts

  tasks:
    - name: Install Python
      raw: "apt-get -y -q install python"
      become: true
      retries: 10
      delay: 20
      #changed_when: false
      # If you run this playbook immediately after Terraform, ssh may not be ready to respond yet


- hosts: kube-all
  gather_facts: yes
  become: yes
  roles:
    - { role: docker, tags: docker }
    - { role: kubernetes/common, tags: common }

- hosts: etcd
  gather_facts: no
  become: yes
  roles:
    - { role: etcd/common, tags: etcd_common }
    - { role: etcd/backup, tags: etcd_backup }
    - { role: etcd/certificates, tags: etcd_certificates }
    - { role: etcd/install, tags: etcd_install }

- hosts: kube-controllers
  gather_facts: yes
  become: yes
  roles:
    - { role: kubernetes/controller, tags: controller }
    - { role: cni, tags: cni }

- hosts: kube-nodes
  gather_facts: yes
  become: yes
  roles:
    - { role: kubernetes/node, tags: node }

